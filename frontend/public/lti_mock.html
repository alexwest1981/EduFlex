<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mock LTI 1.3 Launcher</title>
    <style>
        body { font-family: sans-serif; padding: 2rem; max-width: 800px; margin: 0 auto; background: #f0f2f5; }
        .card { background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #333; }
        label { display: block; margin-top: 1rem; font-weight: bold; }
        input { width: 100%; padding: 0.5rem; margin-top: 0.5rem; border: 1px solid #ccc; border-radius: 4px; }
        button { background: #4f46e5; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; font-size: 1rem; margin-top: 1.5rem; cursor: pointer; }
        button:hover { background: #4338ca; }
        .note { margin-top: 1rem; font-size: 0.875rem; color: #666; background: #eef2ff; padding: 1rem; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="card">
        <h1>üõ†Ô∏è Mock LTI 1.3 Launcher</h1>
        <p>This tool simulates an LMS (like Canvas) starting an LTI launch to EduFlex.</p>
        
        <form action="http://localhost:8080/lti/login_init" method="GET">
            <label>Issuer (iss)</label>
            <input type="text" name="iss" value="https://canvas.instructure.com" readonly>
            
            <label>Login Hint</label>
            <input type="text" name="login_hint" value="user_123">
            
            <label>Target Link URI</label>
            <input type="text" name="target_link_uri" value="http://localhost:8080/lti/launch">
            
            <label>Client ID (Optional)</label>
            <input type="text" name="client_id" value="10000000000001">

            <div class="note">
                <strong>Pre-requisite:</strong> You must have registered this Platform in EduFlex via <code>/lti/platform/register</code> first.
            </div>

            <button type="submit">üöÄ Launch EduFlex</button>
        </form>
    </div>

    <!-- Quick Register Helper -->
    <div class="card" style="margin-top: 2rem;">
        <h2>‚ö° Quick Setup</h2>
        <p>Click below to register the "Canvas Mock" platform in EduFlex so the launch above works.</p>
        <button onclick="registerPlatform()">Register Mock Platform</button>
        <p id="regStatus" style="margin-top: 1rem; color: green; font-weight: bold;"></p>
    </div>

    <script>
        async function registerPlatform() {
            try {
                const res = await fetch('http://localhost:8080/lti/platform/register', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        issuer: "https://canvas.instructure.com",
                        clientId: "10000000000001",
                        authUrl: "https://canvas.instructure.com/api/lti/authorize_redirect",
                        tokenUrl: "https://canvas.instructure.com/login/oauth2/token",
                        jwksUrl: "https://canvas.instructure.com/api/lti/security/jwks"
                    })
                });
                if(res.ok) {
                    document.getElementById('regStatus').innerText = "‚úÖ Platform Registered!";
                } else {
                    document.getElementById('regStatus').innerText = "‚ùå Error: " + res.status;
                }
            } catch(e) {
                document.getElementById('regStatus').innerText = "‚ùå Network Error";
            }
        }
    </script>
</body>
</html>
