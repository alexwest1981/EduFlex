import java.io.File; import java.nio.file.Files; import java.security.KeyFactory; import java.security.PrivateKey; import java.security.Signature; import java.security.spec.PKCS8EncodedKeySpec; import java.util.Base64; public class LicenseIssuer { public static void main(String[] args) throws Exception { if (args.length < 3) { System.out.println("Usage: java LicenseIssuer <Customer> <Tier> <Expiry>"); return; } String customer = args[0]; String tier = args[1]; String expiry = args[2]; String payload = String.format("{\"customer\":\"%s\",\"tier\":\"%s\",\"validUntil\":\"%s\"}", customer, tier, expiry); byte[] keyBytes = Files.readAllBytes(new File("private.pem").toPath()); byte[] keyDecoded = Base64.getDecoder().decode(keyBytes); PKCS8EncodedKeySpec spec = new PKCS8EncodedKeySpec(keyDecoded); KeyFactory kf = KeyFactory.getInstance("RSA"); PrivateKey privateKey = kf.generatePrivate(spec); Signature sign = Signature.getInstance("SHA256withRSA"); sign.initSign(privateKey); sign.update(payload.getBytes("UTF-8")); String signature = Base64.getEncoder().encodeToString(sign.sign()); String licenseJson = String.format("{\"payload\":\"%s\",\"signature\":\"%s\"}", Base64.getEncoder().encodeToString(payload.getBytes("UTF-8")), signature); String finalLicense = Base64.getEncoder().encodeToString(licenseJson.getBytes("UTF-8")); Files.write(new File("license.lic").toPath(), finalLicense.getBytes()); System.out.println("License Generated: license.lic"); } }
