# EduFlex ProGuard Configuration - VERIFICATION MODE

# Java 21 support
-dontwarn **
-ignorewarnings
-dontnote **

# TEMPORARILY DISABLE OBFUSCATION AND OPTIMIZATION
# This is to verify if the NPE is caused by the packaging sequence or the obfuscation itself.
-dontoptimize
-dontobfuscate

# Keep all Spring Boot / Jakarta / Hibernate infrastructure intact
-keep class org.springframework.** { *; }
-keep interface org.springframework.** { *; }
-keep class jakarta.persistence.** { *; }
-keep interface jakarta.persistence.** { *; }
-keep class org.hibernate.** { *; }
-keep interface org.hibernate.** { *; }

# Keep all Spring components and THEIR MEMBERS
-keep @org.springframework.stereotype.Service class * { *; }
-keep @org.springframework.stereotype.Component class * { *; }
-keep @org.springframework.stereotype.Repository class * { *; }
-keep @org.springframework.web.bind.annotation.RestController class * { *; }
-keep @org.springframework.context.annotation.Configuration class * { *; }
-keep @org.springframework.context.annotation.Bean class * { *; }
-keep @jakarta.persistence.Entity class * { *; }
-keep @jakarta.persistence.Embeddable class * { *; }
-keep @jakarta.persistence.MappedSuperclass class * { *; }

# Keep all class members with autowired/lifecycle/JPA annotations
-keepclassmembers class * {
    @org.springframework.beans.factory.annotation.Autowired *;
    @org.springframework.beans.factory.annotation.Value *;
    @jakarta.annotation.PostConstruct *;
    @jakarta.annotation.PreDestroy *;
    @org.springframework.context.annotation.Bean *;
    @jakarta.persistence.* *;
}

# Keep the main application class
-keep class com.eduflex.EduflexApplication { *; }

# Keep everything in model and dto
-keep class com.eduflex.backend.model.** { *; }
-keep class com.eduflex.backend.dto.** { *; }
-keep enum com.eduflex.backend.model.** { *; }

# Keep parameter names and ALL attributes
-keepparameternames
-keepattributes *

# Ensure public constructors are always preserved
-keepclassmembers class * {
    public <init>(...);
}
