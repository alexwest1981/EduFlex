# EduFlex ProGuard Configuration - STABLE CONSERVATIVE MODE

# Java 21 support
-dontwarn **
-ignorewarnings
-dontnote **

# Keep all Spring Boot / Jakarta / Hibernate infrastructure intact
# This prevents NullPointerExceptions during reflection-heavy startup
-keep class org.springframework.** { *; }
-keep interface org.springframework.** { *; }
-keep class jakarta.persistence.** { *; }
-keep interface jakarta.persistence.** { *; }
-keep class org.hibernate.** { *; }
-keep interface org.hibernate.** { *; }

# Keep all Spring components and THEIR MEMBERS
-keep @org.springframework.stereotype.Service class * { *; }
-keep @org.springframework.stereotype.Component class * { *; }
-keep @org.springframework.stereotype.Repository class * { *; }
-keep @org.springframework.web.bind.annotation.RestController class * { *; }
-keep @org.springframework.context.annotation.Configuration class * { *; }
-keep @org.springframework.context.annotation.Bean class * { *; }
-keep @jakarta.persistence.Entity class * { *; }
-keep @jakarta.persistence.Embeddable class * { *; }
-keep @jakarta.persistence.MappedSuperclass class * { *; }

# Keep all class members with autowired/lifecycle/JPA annotations
-keepclassmembers class * {
    @org.springframework.beans.factory.annotation.Autowired *;
    @org.springframework.beans.factory.annotation.Value *;
    @jakarta.annotation.PostConstruct *;
    @jakarta.annotation.PreDestroy *;
    @org.springframework.context.annotation.Bean *;
    @jakarta.persistence.* *;
}

# Keep the main application class
-keep class com.eduflex.EduflexApplication { *; }

# Keep everything in model and dto (Critical for Hibernate/JSON mapping)
-keep class com.eduflex.backend.model.** { *; }
-keep class com.eduflex.backend.dto.** { *; }
-keep enum com.eduflex.backend.model.** { *; }

# Keep parameter names and ALL attributes (Necessary for Spring Proxies)
-keepparameternames
-keepattributes *

# --- THE "PROTECTED" LOGIC ZONE ---
# We keep the structure but allow obfuscation of the implementation details
-keepclassmembers class com.eduflex.backend.service.LicenseService { *; }
-keepclassmembers class com.eduflex.backend.util.RuntimeGuard { *; }
-keepclassmembers class com.eduflex.backend.util.Obfuscator { *; }

# Move obfuscated classes to a specific internal package
-repackageclasses 'com.eduflex.backend.internal'
-allowaccessmodification

# Optimization: OFF (Disabled to prevent stripping of complex reflection patterns)
-dontoptimize

# Ensure public constructors are always preserved
-keepclassmembers class * {
    public <init>(...);
}
