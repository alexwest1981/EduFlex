# EduFlex ProGuard Configuration - CONSERVATIVE MODE

# Java 21 support
-dontwarn **
-ignorewarnings
-dontnote **

# Disable optimizations for now to ensure stability with Spring/Hibernate
-dontoptimize
-dontobfuscate
# (Wait, if I disable obfuscation it defeats the purpose, let's keep obfuscation but disable optimization)
# Actually, let's keep obfuscation but be EXTREMELY careful.

# Keep all Spring Boot / Jakarta / Hibernate infrastructure
-keep class org.springframework.** { *; }
-keep interface org.springframework.** { *; }
-keep class jakarta.persistence.** { *; }
-keep interface jakarta.persistence.** { *; }
-keep class org.hibernate.** { *; }
-keep interface org.hibernate.** { *; }

# Keep all Spring components and THEIR MEMBERS
-keep @org.springframework.stereotype.Service class * { *; }
-keep @org.springframework.stereotype.Component class * { *; }
-keep @org.springframework.stereotype.Repository class * { *; }
-keep @org.springframework.web.bind.annotation.RestController class * { *; }
-keep @org.springframework.context.annotation.Configuration class * { *; }
-keep @org.springframework.context.annotation.Bean class * { *; }
-keep @jakarta.persistence.Entity class * { *; }
-keep @jakarta.persistence.Embeddable class * { *; }
-keep @jakarta.persistence.MappedSuperclass class * { *; }

# Keep all class members with autowired/lifecycle annotations
-keepclassmembers class * {
    @org.springframework.beans.factory.annotation.Autowired *;
    @org.springframework.beans.factory.annotation.Value *;
    @jakarta.annotation.PostConstruct *;
    @jakarta.annotation.PreDestroy *;
    @org.springframework.context.annotation.Bean *;
    @jakarta.persistence.* *;
}

# Keep the main application class
-keep class com.eduflex.EduflexApplication { *; }

# Keep everything in model and dto (Hibernate needs these intact)
-keep class com.eduflex.backend.model.** { *; }
-keep class com.eduflex.backend.dto.** { *; }
-keep enum com.eduflex.backend.model.** { *; }

# Keep parameter names and ALL attributes
-keepparameternames
-keepattributes *
-keepmetadata

# --- THE "PROTECTED" ZONE ---
-keepclassmembers class com.eduflex.backend.service.LicenseService { *; }
-keepclassmembers class com.eduflex.backend.util.RuntimeGuard { *; }
-keepclassmembers class com.eduflex.backend.util.Obfuscator { *; }

# Rename classes but keep package structure for Spring/Hibernate
-repackageclasses 'com.eduflex.backend.internal'
-allowaccessmodification

# Optimization: OFF
-dontoptimize

# Ensure public constructors are kept
-keepclassmembers class * {
    public <init>(...);
}
