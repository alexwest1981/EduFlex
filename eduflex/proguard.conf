# EduFlex ProGuard Configuration

# Java 21 support (Targeting current bytecode)

# Don't warn about Spring/Library dependencies
-dontwarn **
-ignorewarnings
-dontnote **

# Keep all Spring components and THEIR MEMBERS
# Spring needs constructors, fields (for @Value/@Autowired), and methods (for Proxying)
-keep @org.springframework.stereotype.Service class * { *; }
-keep @org.springframework.stereotype.Component class * { *; }
-keep @org.springframework.stereotype.Repository class * { *; }
-keep @org.springframework.web.bind.annotation.RestController class * { *; }
-keep @org.springframework.context.annotation.Configuration class * { *; }
-keep @org.springframework.context.annotation.Bean class * { *; }
-keep @jakarta.persistence.Entity class * { *; }

# Keep all class members with autowired/lifecycle annotations
-keepclassmembers class * {
    @org.springframework.beans.factory.annotation.Autowired *;
    @org.springframework.beans.factory.annotation.Value *;
    @jakarta.annotation.PostConstruct *;
    @jakarta.annotation.PreDestroy *;
    @org.springframework.context.annotation.Bean *;
}

# Keep the main application class and its members
-keep class com.eduflex.EduflexApplication { *; }

# Allow Spring's reflection to work on DTOs and JSON models (Keep everything)
-keep class com.eduflex.backend.model.** { *; }
-keep class com.eduflex.backend.dto.** { *; }
-keep enum com.eduflex.backend.model.** { *; }

# Keep parameter names and all attributes for reflection/proxies
-keepparameternames
-keepattributes *

# --- THE "PROTECTED" ZONE ---
# We keep signatures for injection but obfuscate method bodies
-keepclassmembers class com.eduflex.backend.service.LicenseService { *; }
-keepclassmembers class com.eduflex.backend.util.RuntimeGuard { *; }
-keepclassmembers class com.eduflex.backend.util.Obfuscator { *; }

# Rename classes to a cryptic package
-repackageclasses 'com.eduflex.backend.internal'
-allowaccessmodification

# Optimization passes (Setting to 1 or 0 if issues persist, but 3 should be fine with broad keep rules)
-optimizationpasses 3
-overloadaggressively

# Keep all public constructors for every class to be safe
-keepclassmembers class * {
    public <init>(...);
}
