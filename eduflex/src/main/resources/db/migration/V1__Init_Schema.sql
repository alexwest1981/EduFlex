create table app_users (is_active boolean default true, level integer default 1, login_count integer default 0, points integer default 0, created_at timestamp(6), id bigint generated by default as identity, last_login timestamp(6), role_id bigint, subscription_plan_id bigint, trial_ends_at timestamp(6), address varchar(255), email varchar(255) unique, facebook_url varchar(255), first_name varchar(255), instagram_url varchar(255), language varchar(255), last_name varchar(255), linkedin_url varchar(255), password varchar(255), phone varchar(255), profile_picture_url varchar(255), settings TEXT, ssn varchar(255), twitter_url varchar(255), username varchar(255) unique, primary key (id));
create table assignment (author_id bigint, course_id bigint, due_date timestamp(6), id bigint generated by default as identity, description varchar(5000), title varchar(255), primary key (id));
create table assignment_attachment (assignment_id bigint, id bigint generated by default as identity, name varchar(255), type varchar(255), url varchar(255), primary key (id));
create table attendance (is_present boolean not null, event_id bigint, id bigint generated by default as identity, student_id bigint, note varchar(255), primary key (id));
create table audit_logs (id bigint generated by default as identity, timestamp timestamp(6), action varchar(255), entity_id varchar(255), entity_name varchar(255), modified_by varchar(255), primary key (id));
create table badge (points_required integer not null, id bigint generated by default as identity, description varchar(255), icon_key varchar(255), name varchar(255), primary key (id));
create table calendar_event_attendees (event_id bigint not null, user_id bigint not null, primary key (event_id, user_id));
create table calendar_events (is_mandatory boolean, course_id bigint, end_time timestamp(6), id bigint generated by default as identity, owner_id bigint, start_time timestamp(6), description varchar(255), meeting_link varchar(255), platform varchar(255) check (platform in ('ZOOM','TEAMS','MEETS','NONE')), status varchar(255) check (status in ('PENDING','CONFIRMED','CANCELLED')), title varchar(255), topic varchar(255), type varchar(255) check (type in ('LESSON','MEETING','WORKSHOP','EXAM','ASSIGNMENT','OTHER')), primary key (id));
create table chat_messages (is_read boolean not null, id bigint generated by default as identity, recipient_id bigint, sender_id bigint, timestamp timestamp(6), content varchar(2000), recipient_name varchar(255), sender_name varchar(255), type varchar(255), primary key (id));
create table connections (created_at timestamp(6), id bigint generated by default as identity, receiver_id bigint not null, requester_id bigint not null, updated_at timestamp(6), status varchar(255) not null check (status in ('PENDING','ACCEPTED','REJECTED','BLOCKED')), primary key (id), unique (requester_id, receiver_id));
create table course_applications (applied_at timestamp(6), course_id bigint, id bigint generated by default as identity, student_id bigint, status varchar(255) check (status in ('PENDING','APPROVED','REJECTED')), primary key (id));
create table course_evaluation_responses (evaluation_id bigint, id bigint generated by default as identity, student_id bigint, submitted_at timestamp(6), primary key (id));
create table course_evaluations (active boolean not null, course_id bigint unique, id bigint generated by default as identity, primary key (id));
create table course_materials (available_from timestamp(6), course_id bigint, id bigint generated by default as identity, content varchar(5000), file_url varchar(255), link varchar(255), title varchar(255), type varchar(255) check (type in ('TEXT','VIDEO','FILE','LINK','LESSON','STUDY_MATERIAL','QUESTIONS')), primary key (id));
create table course_results (course_id bigint, graded_at timestamp(6), id bigint generated by default as identity, student_id bigint, note varchar(255), status varchar(255) check (status in ('PENDING','PASSED','FAILED')), primary key (id));
create table course_students (course_id bigint not null, student_id bigint not null, primary key (course_id, student_id));
create table courses (is_open boolean not null, max_students integer default 100, id bigint generated by default as identity, skolverket_course_id bigint, teacher_id bigint, description varchar(5000), category varchar(255), classroom_link varchar(255), classroom_type varchar(255), color varchar(255), course_code varchar(255) unique, end_date varchar(255), exam_link varchar(255), exam_type varchar(255), name varchar(255), start_date varchar(255), primary key (id));
create table document_shares (document_id bigint not null, user_id bigint not null, primary key (document_id, user_id));
create table documents (id bigint generated by default as identity, size bigint, uploaded_at timestamp(6), user_id bigint, file_name varchar(255), file_type varchar(255), file_url varchar(255), primary key (id));
create table evaluation_answers (question_index integer not null, response_id bigint not null, answer_data varchar(1000), primary key (question_index, response_id));
create table evaluation_questions (evaluation_id bigint not null, question varchar(255));
create table forum_category (teacher_only boolean not null, course_id bigint, id bigint generated by default as identity, description varchar(255), name varchar(255), primary key (id));
create table forum_post (author_id bigint, created_at timestamp(6), id bigint generated by default as identity, thread_id bigint, content varchar(5000), primary key (id));
create table forum_thread (locked boolean not null, author_id bigint, category_id bigint, course_id bigint, created_at timestamp(6), id bigint generated by default as identity, content varchar(5000), title varchar(255), primary key (id));
create table group_rooms (course_id bigint, id bigint generated by default as identity, link varchar(255), name varchar(255), type varchar(255), primary key (id));
create table invoices (amount numeric(10,2) not null, auto_generated boolean not null, discount_amount numeric(10,2) not null, due_date date not null, issue_date date not null, paid_date date, created_at timestamp(6) not null, id bigint generated by default as identity, payment_id bigint, subscription_plan_id bigint, updated_at timestamp(6) not null, user_id bigint not null, currency varchar(255) not null, description TEXT, invoice_number varchar(255) not null unique, notes TEXT, pdf_url varchar(255), promo_code varchar(255), status varchar(255) not null check (status in ('DRAFT','PENDING','SENT','PAID','OVERDUE','CANCELLED','REFUNDED')), primary key (id));
create table lesson (sort_order integer not null, author_id bigint, course_id bigint, id bigint generated by default as identity, content varchar(10000), attachment_name varchar(255), attachment_url varchar(255), title varchar(255), video_url varchar(255), primary key (id));
create table lti_platforms (id bigint generated by default as identity, auth_url varchar(255) not null, client_id varchar(255) not null, deployment_id varchar(255), issuer varchar(255) not null unique, jwks_url varchar(255) not null, token_url varchar(255) not null, primary key (id));
create table messages (is_read boolean default false, id bigint generated by default as identity, recipient_id bigint not null, sender_id bigint not null, timestamp timestamp(6), content TEXT, subject varchar(255), primary key (id));
create table notifications (is_read boolean not null, created_at timestamp(6), id bigint generated by default as identity, user_id bigint, message varchar(255), type varchar(255), primary key (id));
create table organization_branding (custom_email_templates boolean not null, enforce_org_theme boolean not null, show_powered_by boolean not null, created_at timestamp(6) not null, id bigint generated by default as identity, updated_at timestamp(6) not null, default_theme_id varchar(50), design_system varchar(50), favicon_url varchar(500), login_background_url varchar(500), logo_url varchar(500), brand_name varchar(255), custom_css TEXT, custom_theme TEXT, footer_text varchar(255), organization_key varchar(255) not null unique, welcome_message TEXT, primary key (id));
create table payment_settings (is_active boolean, is_test_mode boolean, id bigint generated by default as identity, api_key TEXT, enabled_methods TEXT, provider varchar(255), webhook_secret TEXT, primary key (id));
create table payments (amount numeric(10,2) not null, created_at timestamp(6) not null, due_date timestamp(6), id bigint generated by default as identity, payment_date timestamp(6), subscription_plan_id bigint, updated_at timestamp(6) not null, user_id bigint not null, currency varchar(255) not null, description TEXT, metadata TEXT, payment_method varchar(255) not null check (payment_method in ('CARD','SWISH','INVOICE','BANK_TRANSFER','OTHER')), status varchar(255) not null check (status in ('PENDING','PROCESSING','COMPLETED','FAILED','CANCELLED','REFUNDED')), transaction_id varchar(255) unique, primary key (id));
create table promo_codes (current_uses integer not null, discount_value numeric(10,2) not null, is_active boolean not null, max_uses integer not null, created_at timestamp(6) not null, id bigint generated by default as identity, valid_from timestamp(6), valid_until timestamp(6), code varchar(255) not null unique, discount_type varchar(255) not null check (discount_type in ('PERCENTAGE','FIXED_AMOUNT')), primary key (id));
create table question_bank_item (author_id bigint not null, id bigint generated by default as identity, category varchar(255), correct_answer varchar(255), difficulty varchar(255) check (difficulty in ('EASY','MEDIUM','HARD')), question_text TEXT not null, type varchar(255) check (type in ('MULTIPLE_CHOICE','OPEN','TRUE_FALSE')), primary key (id));
create table question_bank_item_options (question_bank_item_id bigint not null, options varchar(255));
create table quiz_options (is_correct boolean not null, id bigint generated by default as identity, question_id bigint, text varchar(255), primary key (id));
create table quiz_questions (id bigint generated by default as identity, quiz_id bigint, text varchar(255), primary key (id));
create table quiz_results (max_score integer not null, score integer not null, date timestamp(6), id bigint generated by default as identity, quiz_id bigint, student_id bigint, primary key (id));
create table quizzes (author_id bigint, available_from timestamp(6), available_to timestamp(6), course_id bigint, id bigint generated by default as identity, description varchar(255), title varchar(255), primary key (id));
create table role_permissions (role_id bigint not null, permission varchar(255) check (permission in ('VIEW_DASHBOARD','VIEW_COURSES','VIEW_PROFILE','COURSE_CREATE','COURSE_EDIT','COURSE_DELETE','COURSE_VIEW_ALL','GRADE_ASSIGN','GRADE_VIEW','USER_CREATE','USER_EDIT','USER_DELETE','USER_VIEW_ALL','ROLE_MANAGE','SETTINGS_MANAGE','MODULE_MANAGE','AUDIT_VIEW','SCORM_UPLOAD','SCORM_DELETE','REVENUE_VIEW','SUBSCRIPTION_MANAGE')));
create table roles (is_super_admin boolean default false, id bigint generated by default as identity, default_dashboard varchar(255), description varchar(255), name varchar(255) not null unique, primary key (id));
create table scorm_packages (course_id bigint, id bigint generated by default as identity, size_bytes bigint not null, uploaded_at timestamp(6), directory_path varchar(255) not null, launch_file varchar(255) not null, title varchar(255) not null, primary key (id));
create table skolverket_courses (points integer not null, created_at timestamp(6), id bigint generated by default as identity, course_code varchar(50) not null unique, description varchar(2000), objectives varchar(5000), subject_purpose varchar(5000), course_name varchar(255) not null, english_title varchar(255), pdf_url varchar(255), skolformer varchar(255), subject varchar(255) not null, primary key (id));
create table skolverket_grading_criteria (grade_level varchar(1) not null, sort_order integer not null, id bigint generated by default as identity, skolverket_course_id bigint not null, criteria_text varchar(10000) not null, primary key (id));
create table student_activity_logs (course_id bigint not null, id bigint generated by default as identity, material_id bigint, timestamp timestamp(6) not null, user_id bigint not null, details varchar(1000), activity_type varchar(255) not null check (activity_type in ('VIEW_LESSON','DOWNLOAD_FILE','WATCH_VIDEO','COURSE_ACCESS')), primary key (id));
create table submission (assignment_id bigint, id bigint generated by default as identity, student_id bigint, submitted_at timestamp(6), feedback varchar(255), file_name varchar(255), file_type varchar(255), file_url varchar(255), grade varchar(255), status varchar(255) check (status in ('SUBMITTED','RETURNED','GRADED')), primary key (id));
create table subscription_plan_features (plan_id bigint not null, feature varchar(255));
create table subscription_plans (active boolean not null, is_default boolean not null, max_courses integer not null, max_storage integer not null, max_users integer not null, price numeric(10,2) not null, sort_order integer not null, trial_period_days integer default 0, created_at timestamp(6) not null, id bigint generated by default as identity, updated_at timestamp(6) not null, billing_interval varchar(255) not null check (billing_interval in ('MONTHLY','YEARLY','LIFETIME')), currency varchar(255) not null, description TEXT, display_name varchar(255) not null, name varchar(255) not null unique, primary key (id));
create table system_modules (is_active boolean default false, requires_license boolean default false, id bigint generated by default as identity, description varchar(255), module_key varchar(255) not null unique, name varchar(255), version varchar(255), primary key (id));
create table system_settings (id bigint generated by default as identity, description varchar(255), setting_key varchar(255) not null unique, setting_value varchar(255), primary key (id));
create table tenants (is_active boolean not null, created_at timestamp(6) not null, updated_at timestamp(6), id varchar(50) not null, db_schema varchar(255) not null unique, domain varchar(255) unique, name varchar(255) not null, primary key (id));
create table user_documents (upload_date date, id bigint generated by default as identity, user_id bigint not null, description varchar(5000), content_type varchar(255), file_name varchar(255), file_url varchar(255), title varchar(255) not null, type varchar(255) not null, primary key (id));
create table user_lesson_progress (id bigint generated by default as identity, material_id bigint, user_id bigint, viewed_at timestamp(6), primary key (id));
create table user_badge (badge_id bigint, earned_at timestamp(6), id bigint generated by default as identity, user_id bigint, primary key (id));
alter table if exists app_users add constraint FK7sipqsfa0da9aj10gga1iqnk1 foreign key (role_id) references roles;
alter table if exists app_users add constraint FKm7k9w22yhpj0ylr9igrv3yc87 foreign key (subscription_plan_id) references subscription_plans;
alter table if exists assignment add constraint FKg5bksn00dqc0qe4gfl07q5vf3 foreign key (author_id) references app_users;
alter table if exists assignment add constraint FKjdb8i3vawy0s72p9py8xvgufu foreign key (course_id) references courses;
alter table if exists assignment_attachment add constraint FKidpv2brpweilkjkl7ntoh7ocu foreign key (assignment_id) references assignment;
alter table if exists attendance add constraint FK388h8qlueeatq7ji42v3qhg0j foreign key (event_id) references calendar_events;
alter table if exists attendance add constraint FKia8cxb8ideg6b30mkshlr1ief foreign key (student_id) references app_users;
alter table if exists calendar_event_attendees add constraint FK82cuhe2jt11wq6fyqup3ymlwd foreign key (user_id) references app_users;
alter table if exists calendar_event_attendees add constraint FKatrikfeewmgshk40l99u2r3q8 foreign key (event_id) references calendar_events;
alter table if exists calendar_events add constraint FKf4gp5n249fuc8je9hoapsw325 foreign key (course_id) references courses;
alter table if exists calendar_events add constraint FK85aim5hic6hacu9ji1kqm1lvl foreign key (owner_id) references app_users;
alter table if exists connections add constraint FKfhgm2msj637aw88hq3a6pssf foreign key (receiver_id) references app_users;
alter table if exists connections add constraint FK3ayqtans56n64x5stw9wbis9e foreign key (requester_id) references app_users;
alter table if exists course_applications add constraint FKjiyy1pc4j07mvgk31a6pi432 foreign key (course_id) references courses;
alter table if exists course_applications add constraint FKpc73h2gk1f1fcnp9bnx8qxgx0 foreign key (student_id) references app_users;
alter table if exists course_evaluation_responses add constraint FKtjenw2ctm5cnd8nfeekapcjj4 foreign key (evaluation_id) references course_evaluations;
alter table if exists course_evaluation_responses add constraint FKieft37j9nl5d2ua93mnoqnvq6 foreign key (student_id) references app_users;
alter table if exists course_evaluations add constraint FKdn857pgs4kja8ec15g05ispgk foreign key (course_id) references courses;
alter table if exists course_materials add constraint FKjobqk7m872wjsw0y29tle6wek foreign key (course_id) references courses;
alter table if exists course_results add constraint FK1lay2fdvi18yv1q0gwj37asgo foreign key (course_id) references courses;
alter table if exists course_results add constraint FKlee879ijutco737kvn5tpgh3y foreign key (student_id) references app_users;
alter table if exists course_students add constraint FK9m1njobugeslrthueu0kscufl foreign key (student_id) references app_users;
alter table if exists course_students add constraint FKj5fbpmgy0y0es0gvk0311jor3 foreign key (course_id) references courses;
alter table if exists courses add constraint FKktp46jcv3s5j66mqo2rh1m06w foreign key (skolverket_course_id) references skolverket_courses;
alter table if exists courses add constraint FKa837t6hcl5fu15ykhynhu4a5p foreign key (teacher_id) references app_users;
alter table if exists document_shares add constraint FK9qow7y7nfkrw8wckfkvlvmscv foreign key (user_id) references app_users;
alter table if exists document_shares add constraint FK2q6i3ymobf720h0xq3gdvhabn foreign key (document_id) references documents;
alter table if exists documents add constraint FK6l07m6e0swx8ipar9qkf5j4f foreign key (user_id) references app_users;
alter table if exists evaluation_answers add constraint FKy9y7yy0f0a4ex5nwl4pnynj3 foreign key (response_id) references course_evaluation_responses;
alter table if exists evaluation_questions add constraint FKhm2ycg52ejevwilvs4atjupo8 foreign key (evaluation_id) references course_evaluations;
alter table if exists forum_category add constraint FKstglny2nhytudfeeqy0hpc3su foreign key (course_id) references courses;
alter table if exists forum_post add constraint FKpgcn4dmj48jewx16skopgkmht foreign key (author_id) references app_users;
alter table if exists forum_post add constraint FK65dn0u9uxdwh25jcqgb3portb foreign key (thread_id) references forum_thread;
alter table if exists forum_thread add constraint FK1gn01930x1x5srafs6yrh4f7e foreign key (author_id) references app_users;
alter table if exists forum_thread add constraint FKjj6vyrrb5r02985uwrdw9men6 foreign key (category_id) references forum_category;
alter table if exists forum_thread add constraint FKmki3ehnj0tpvi5rka4f1al6kf foreign key (course_id) references courses;
alter table if exists group_rooms add constraint FK8mdnou5s4f8f80gf2h1k7qctq foreign key (course_id) references courses;
alter table if exists invoices add constraint FKq6fs19k0gqw3rg0mb87h60h6p foreign key (payment_id) references payments;
alter table if exists invoices add constraint FK1euslilb5y605065iwhrbyhoy foreign key (subscription_plan_id) references subscription_plans;
alter table if exists invoices add constraint FK481rrej87l5vhpwnkxfghygdp foreign key (user_id) references app_users;
alter table if exists lesson add constraint FK8fqutem57nisgyd15iks5h3wr foreign key (author_id) references app_users;
alter table if exists lesson add constraint FKbnmu2xq9klrrg69rs7lcn5fku foreign key (course_id) references courses;
alter table if exists messages add constraint FK89nbvyy8uuabx647ggdyle2ew foreign key (recipient_id) references app_users;
alter table if exists messages add constraint FKiwmjso15wbkeq7hkvg6noqh5v foreign key (sender_id) references app_users;
alter table if exists payments add constraint FKqktpyvm52unwea52wlls77qes foreign key (subscription_plan_id) references subscription_plans;
alter table if exists payments add constraint FKfsmtld1oj3q6j8apfiy0krxom foreign key (user_id) references app_users;
alter table if exists question_bank_item add constraint FK113dgt2136yutde2wwsv2mey6 foreign key (author_id) references app_users;
alter table if exists question_bank_item_options add constraint FKh8wsq3sblu5pg0mxdk6rpk9ha foreign key (question_bank_item_id) references question_bank_item;
alter table if exists quiz_options add constraint FKhkuvmd7qk1lmtq3hy9htpinkr foreign key (question_id) references quiz_questions;
alter table if exists quiz_questions add constraint FKanfmgf6ksbdnv7ojb0pfve54q foreign key (quiz_id) references quizzes;
alter table if exists quiz_results add constraint FKmmvfwhutqbn5u6n25e4405pw9 foreign key (quiz_id) references quizzes;
alter table if exists quiz_results add constraint FKjh5ko3hw4hxf5a7ovbow29yuw foreign key (student_id) references app_users;
alter table if exists quizzes add constraint FK2xp9y6r7loishfkqcd9473cug foreign key (author_id) references app_users;
alter table if exists quizzes add constraint FKpxdnhxeppxx606nhyjtjyharp foreign key (course_id) references courses;
alter table if exists role_permissions add constraint FKn5fotdgk8d1xvo8nav9uv3muc foreign key (role_id) references roles;
alter table if exists scorm_packages add constraint FKnn3buk3m3m775uwpba27fqoug foreign key (course_id) references courses;
alter table if exists skolverket_grading_criteria add constraint FK57566fl4dy49y6jefisp4e9fi foreign key (skolverket_course_id) references skolverket_courses;
alter table if exists student_activity_logs add constraint FKrny66y50eei4s8o2gts10ulev foreign key (course_id) references courses;
alter table if exists student_activity_logs add constraint FKtrlf2w0ylom5oaljti6e0mhxa foreign key (material_id) references course_materials;
alter table if exists student_activity_logs add constraint FKnhgg9wk85cp1hbb5jlm042nvm foreign key (user_id) references app_users;
alter table if exists submission add constraint FK3q8643roa73llngo64dvpvtxt foreign key (assignment_id) references assignment;
alter table if exists submission add constraint FK1wgguismioyeyq26uhljsi01p foreign key (student_id) references app_users;
alter table if exists subscription_plan_features add constraint FKc6lqgpqagbm2w7hghiokkcsgw foreign key (plan_id) references subscription_plans;
alter table if exists user_documents add constraint FK9cd930p6n5kisdk006hi1q9q8 foreign key (user_id) references app_users;
alter table if exists user_lesson_progress add constraint FKjqibkqeowkojk7y2002cx8n6s foreign key (material_id) references course_materials;
alter table if exists user_lesson_progress add constraint FKpnxffw46pgy7i47djw2qwgpr4 foreign key (user_id) references app_users;
alter table if exists user_badge add constraint FKjqx9n26pk9mqf1qo8f7xvvoq9 foreign key (badge_id) references badge;
alter table if exists user_badge add constraint FKilrx9ege0gbpae9qxosqvwjnm foreign key (user_id) references app_users;
